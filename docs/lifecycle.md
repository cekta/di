# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç—Ä–∏ —Ç–∏–ø–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –≤ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö:

* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –Ω–∞ RoadRunner –∏–ª–∏ FrankenPHP
* –§–æ–Ω–æ–≤—ã—Ö workers
* –ö–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á

–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ª—é–±—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: containers, params, alias –∏ autowiring.

## üîÑ –¢–∏–ø—ã –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

### 1. Scoped (–û–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏) ‚≠ê –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

* –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–æ–∑–¥–∞—ë—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
* –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –∫–æ–ø–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. Singleton (–û–¥–∏–Ω–æ—á–∫–∞)

* –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–æ–∑–¥–∞—ë—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≤—Å—ë –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞**
* –í—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä singletons –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. Factory (–§–∞–±—Ä–∏–∫–∞)

* –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä factories –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```php
<?php
declare(strict_types=1);

namespace App;

class Scoped {}
class Singleton {}
class Factory {}

new \Cekta\DI\Compiler(
    containers: [
        Scoped::class,
        Singleton::class,
        Factory::class,
    ],
    fqcn: 'App\\Runtime\\Container',
    singletons: [Singleton::class],   // Singleton-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    factories: [Factory::class],      // Factory-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    // Scoped-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —è–≤–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
)->compile();
```

### üß™ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

[–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ GitHub](https://github.com/cekta/di-example-usage/commit/26fbb6bfd702c8d055818f61632d377c6bc3c40d)

```php
<?php
declare(strict_types=1);

namespace App;

function testLifecycle(string $className) {
    $container1 = new \App\Runtime\Container();
    $container2 = new \App\Runtime\Container();
    
    $a = $container1->get($className);
    $b = $container1->get($className);  // –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ç–æ–º—É –∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
    $c = $container2->get($className);  // –ó–∞–ø—Ä–æ—Å –∫ –¥—Ä—É–≥–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
    
    echo "–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: " . ($a === $b ? "–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π" : "—Ä–∞–∑–Ω—ã–π") . "\n";
    echo "–ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: " . ($a === $c ? "–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π" : "—Ä–∞–∑–Ω—ã–π") . "\n";
    echo "---\n";
}

echo "Scoped (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):\n";
testLifecycle(Scoped::class);

echo "Singleton:\n";
testLifecycle(Singleton::class);

echo "Factory:\n";
testLifecycle(Factory::class);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Scoped (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
–ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: —Ä–∞–∑–Ω—ã–π
---
Singleton:
–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
–ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
---
Factory:
–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: —Ä–∞–∑–Ω—ã–π
–ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: —Ä–∞–∑–Ω—ã–π
```

## üéØ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

| –¢–∏–ø       | –í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ | –ú–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏	 | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                          |
|-----------|--------------------------|-----------------------------|---------------------------------------------|
| Scoped ‚≠ê  | 	–û–¥–∏–Ω –æ–±—ä–µ–∫—Ç	            | –†–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã	             | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏ |
| Singleton | 	–û–¥–∏–Ω –æ–±—ä–µ–∫—Ç             | –û–¥–∏–Ω –æ–±—ä–µ–∫—Ç	                | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –∫–µ—à–∏        |
| Factory   | 	–†–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã	         | –†–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã	             | Stateless-—Å–µ—Ä–≤–∏—Å—ã, DTO, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ    |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Scoped –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –¥—Ä—É–≥–æ–π —Ç–∏–ø, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Scoped
2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤** ‚Äî –Ω–µ–ª—å–∑—è —É–∫–∞–∑–∞—Ç—å –æ–¥–∏–Ω –∫–ª–∞—Å—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∫–∞–∫ Singleton –∏ Factory
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî Factory —Å–æ–∑–¥–∞—ë—Ç –Ω–∞–∏–±–æ–ª—å—à—É—é –Ω–∞–≥—Ä—É–∑–∫—É, Singleton ‚Äî –Ω–∞–∏–º–µ–Ω—å—à—É—é
4. **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî Singleton –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö

## üöÄ –ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```php
<?php
new \Cekta\DI\Compiler(
    containers: [
        HttpController::class,
        UserRepository::class,
        EmailService::class,
    ],
    singletons: [
        Database::class,           // –û–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        RedisCache::class,         // –û–±—â–∏–π –∫–µ—à
        Config::class,             // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ],
    factories: [
        HttpRequest::class,        // –ù–æ–≤—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        UserSession::class,        // –ù–æ–≤—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ],
);
```

---

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* [x] –≠–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã (Singleton)
* [x] –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (Scoped)
* [x] –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (Factory)
* [x] –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ